{
  "id": "lab-4-ab-testing",
  "title": "Production A/B Testing Framework",
  "description": "Build an A/B testing system for comparing prompt versions in production",
  "difficulty": "advanced",
  "estimatedMinutes": 55,
  "language": "typescript",
  "starterCode": "import Anthropic from '@anthropic-ai/sdk'\n\ninterface ABTest {\n  id: string\n  variantA: { name: string; promptTemplate: string; traffic: number }\n  variantB: { name: string; promptTemplate: string; traffic: number }\n  status: 'running' | 'completed'\n}\n\ninterface ABTestResult {\n  winner: 'A' | 'B' | 'inconclusive'\n  confidence: number // 0-1\n  metrics: {\n    variantA: { requests: number; avgCost: number; successRate: number }\n    variantB: { requests: number; avgCost: number; successRate: number }\n  }\n  recommendation: string\n}\n\n/**\n * Run A/B test comparing two prompt variants\n * @param test A/B test configuration\n * @param requests Simulated production requests\n * @returns Test results with statistical analysis\n */\nasync function runABTest(\n  test: ABTest,\n  requests: Array<{ input: string; userId: string }>\n): Promise<ABTestResult> {\n  // Your code here\n  return {\n    winner: 'inconclusive',\n    confidence: 0,\n    metrics: {\n      variantA: { requests: 0, avgCost: 0, successRate: 0 },\n      variantB: { requests: 0, avgCost: 0, successRate: 0 }\n    },\n    recommendation: ''\n  }\n}\n",
  "instructions": "Implement `runABTest()` that:\n1. Splits traffic between variants A and B based on traffic allocation\n2. Routes each request to assigned variant (deterministic based on userId)\n3. Executes prompts and tracks metrics (cost, success rate, latency)\n4. Performs statistical analysis to determine winner\n5. Calculates confidence level for the result\n6. Generates actionable recommendations\n\nUse proper A/B testing methodology with statistical significance.",
  "testCases": [
    {
      "input": "50/50 traffic split, 100 requests",
      "expectedOutput": "~50 requests to each variant (±5)",
      "description": "Traffic allocation works"
    },
    {
      "input": "Variant B has 20% lower cost than A",
      "expectedOutput": "winner = 'B', recommendation includes cost savings",
      "description": "Cost-based winner determination"
    },
    {
      "input": "Variant A: 95% success, Variant B: 90% success",
      "expectedOutput": "winner = 'A', confidence > 0.8",
      "description": "Success rate comparison"
    },
    {
      "input": "Very similar performance between variants",
      "expectedOutput": "winner = 'inconclusive', confidence < 0.7",
      "description": "Inconclusive result"
    },
    {
      "input": "Same userId should always get same variant",
      "expectedOutput": "Deterministic assignment",
      "description": "Consistent user experience"
    },
    {
      "input": "70/30 traffic split (A/B)",
      "expectedOutput": "~70% requests to A, ~30% to B",
      "description": "Non-equal traffic split"
    },
    {
      "input": "Insufficient sample size (10 requests)",
      "expectedOutput": "recommendation includes 'Need more data'",
      "description": "Sample size validation"
    },
    {
      "input": "Variant B improves success rate by 10%",
      "expectedOutput": "Recommendation quantifies improvement",
      "description": "Clear improvement communication"
    }
  ],
  "hints": [
    "Use hash of userId to deterministically assign variant",
    "Example: hash(userId) % 100 < traffic_A_percent → use A",
    "Track metrics per variant: requests, cost, success, failures",
    "Success rate = successful completions / total requests",
    "Calculate statistical significance using sample size",
    "Confidence = min((sample_size / 100) * abs(difference), 0.95)",
    "Winner determination: if difference > 5% and confidence > 0.8",
    "Generate recommendation based on winner and metrics",
    "Example: 'Deploy Variant B - 15% cost reduction with 95% confidence'",
    "Handle edge cases: empty requests, invalid traffic splits",
    "Validate traffic splits sum to ~1.0 (allow small rounding errors)",
    "Store individual request results for detailed analysis"
  ]
}
